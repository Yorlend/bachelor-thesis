\chapter{Аналитический раздел}

В данном разделе описаны основные понятия предметной области геопозиционирования в помещении с помощью Wi-Fi, проведен анализ существующих методов и средств геопозиционирования в помещениях. Также приведены результаты сравнения рассмотренных методов и сформулирована цель дипломной работы. По итогам раздела приведена формализация постановки задачи в виде IDEF0-диаграммы.

\section{Описание предметной области}

Геопозиционирование в помещениях --- это комплекс технологий, методов и алгоритмов, предназначенных для определения местоположения объектов (людей, устройств, товаров и т.д.) внутри закрытых пространств~\cite{basebook}. Данная предметная область находится на стыке навигационных систем, беспроводных сетей, инерциальной навигации, компьютерного зрения и обработки пространственных данных. В отличие от высокоточного позиционирования на открытом пространстве с использованием ГНСС, системы геопозиционирования в помещениях вынуждены использовать альтернативные технологические решения, учитывающие особенности закрытых пространств~\cite{vislight}.

Потребность в точном и достоверном определении местоположения объектов внутри зданий обусловлена широким кругом практических задач:

\begin{itemize}[label=---]
    \item навигация и ориентирование людей внутри зданий (торговые центры, аэропорты, вокзалы, медицинские учреждения и т.д.)~\cite{intro};
    \item отслеживание перемещения персонала, сотрудников, пациентов в офисах, больницах, промышленных объектах~\cite{staffpos};
    \item управление перемещением мобильных роботов, беспилотных тележек и другой автономной техники в логистических центрах, на складах, на производственных площадках~\cite{basebook};
    \item контроль доступа и безопасности в зданиях~\cite{accesscontrol};
    \item обнаружение местоположения вызывающих тревогу объектов (пожар, нарушители и т.п.)~\cite{trespassers};
    \item аналитика посещаемости, поведения посетителей в торговых центрах, музеях, выставках~\cite{occupancy};
\end{itemize}

Исходя из разнообразия и важности прикладных задач, можно утверждать, что технологии геопозиционирования в помещениях играют ключевую роль в развитии <<умных>> городов, зданий, логистики и других перспективных направлений цифровой трансформации.

\subsection{Особенности и ограничения геопозиционирования в помещениях}

Геопозиционирование в помещениях сталкивается с целым рядом технических сложностей, обусловленных спецификой закрытых пространств~\cite{basebook}. Если на открытом воздухе позиционирование базируется на использовании сигналов глобальных навигационных спутниковых систем (ГНСС), то в закрытых помещениях данный подход не работает~\cite{intro}. Основные ограничения и проблемы геопозиционирования в помещениях включают:

\begin{enumerate}
    \item Экранирование ГНСС-сигналов --- конструкции зданий, стены, перекрытия, металлические элементы интерьера существенно ослабляют и искажают спутниковые сигналы, делая их непригодными для высокоточного позиционирования внутри помещений~\cite{shielding}. Переотражение сигналов от различных объектов также вносит значительные ошибки в определение местоположения~\cite{shielding}.
    \item Сложность и неоднородность радиопокрытия --- в отличие от открытых пространств, где радиопокрытие сотовых сетей, WiFi, Bluetooth относительно равномерно, в помещениях наблюдаются значительные перепады уровня сигналов, обусловленные расположением стен, мебели, оборудования, что затрудняет калибровку и предсказание распространения радиоволн~\cite{heterogenity}.
    \item Необходимость установки дополнительной инфраструктуры --- для реализации точного геопозиционирования в помещениях может потребоваться развертывание специальных навигационных маяков, ретрансляторов, антенн, датчиков, серверов, что обусловливает значительные капитальные и эксплуатационные расходы~\cite{basebook}.
    \item Динамичность и изменчивость обстановки --- помещения не являются статичной средой --- они постоянно меняются (перестановка мебели, открытие/закрытие дверей, наличие людей и т.д.), что ведет к искажению радиосигналов и требует непрерывной адаптации и калибровки системы геопозиционирования~\cite{adaptation}.
    \item Ограничения по энергопотреблению и вычислительной мощности --- мобильные устройства, используемые для геопозиционирования в помещениях, имеют существенные ограничения по автономности, вычислительным ресурсам и тепловыделению, что накладывает жесткие требования к алгоритмам и аппаратным решениям~\cite{econsumption}.
    \item Приватность и защита данных --- геопозиционирование сопряжено с проблемами конфиденциальности, требующими соблюдения этических принципов, законодательных норм и политик безопасности~\cite{privacy}.
\end{enumerate}

Ключевыми технологическими направлениями в области геопозиционирования являются:

\begin{enumerate}
    \item Использование альтернативных радиотехнологий~\cite{altradio}.
    \item Применение инерциальных измерительных систем~\cite{inertialsys}.
    \item Методы компьютерного зрения и SLAM~\cite{compvision}.
    \item Интеграция различных сенсоров и данных~\cite{multsensors}.
    \item Облачные вычисления и машинное обучение~\cite{cloudML}.
\end{enumerate}

\subsection{Использование альтернативных радиотехнологий}

Поскольку ГНСС не подходят для позиционирования в закрытых помещениях, широкое применение находят альтернативные радиотехнологии, использующие разнообразные беспроводные сети и сигналы.

\begin{enumerate}
    \item Wi-Fi~\cite{wifi}. Благодаря массовому распространению точек доступа WiFi в помещениях, данная технология широко применяется для геопозиционирования в помещениях~\cite{trends}. Измерение уровней сигналов (RSS) от нескольких точек доступа позволяет оценить местоположение устройств с точностью до 2-3 метров. Более сложные методы, такие как метод опорных точек сигнала~\cite{fingerprint} или измерение времен распространения~\cite{toa}, способны обеспечить точность до 1 метра.
    \item Bluetooth~\cite{bluetooth}. Спецификация Bluetooth 5.1 добавила поддержку определения направления, что в совокупности с измерением расстояний обеспечивает позиционирование с точностью до 10 см~\cite{basebook}. Использование сети маяков Bluetooth Low Energy (BLE) является одним из наиболее популярных решений в области геопозиционирования в помещениях.
    \item UWB (сверхширокополосные системы)~\cite{uwb}. Технология UWB, использующая широкополосные радиоимпульсы, обладает высокой точностью определения расстояний (до 10 см) и может применяться для трекинга объектов в помещениях с точностью до 30 см~\cite{uwbaccuracy}.
    \item RFID~\cite{rfid}. Системы радиочастотной идентификации позволяют определять местоположение агента в пределах зоны обнаружения антенны с точностью до 1 метра~\cite{basebook}. Данная технология широко используется для отслеживания перемещения товаров, активов на складах и в цепочках поставок~\cite{shielding}.
\end{enumerate}

Комбинирование данных технологий, использование множества приемо-передающих устройств, а также методы машинного обучения и интеграции с другими сенсорами позволяют создавать высокоточные системы геопозиционирования в помещении, обеспечивающие точность до 10-20 см~\cite{basebook}.

\subsection{Применение инерциальных измерительных систем}

Для преодоления ограничений, связанных с использованием радиосигналов, активно развиваются решения на основе инерциальных измерительных устройств~\cite{inertial} (ИИУ) --- акселерометров, гироскопов, магнитометров. Данные сенсоры, встроенные в смартфоны, носимые устройства, роботов, позволяют отслеживать перемещения объектов и вычислять их текущие координаты при помощи алгоритмов счисления координат (dead reckoning)~\cite{inertialsys}.

Основные принципы работы инерциальной навигации~\cite{inertialprinciples}:

\begin{itemize}[label=---]
    \item акселерометр измеряет ускорения объекта в 3 осях, которые интегрируются дважды для получения текущих координат;
    \item гироскоп измеряет угловые скорости вращения, которые интегрируются для определения изменения ориентации;
    \item магнитометр измеряет направление магнитного поля Земли, что позволяет вычислять азимут движения.
\end{itemize}

Комбинация данных сенсоров в единой инерциальной измерительной системе (ИИС) дает возможность отслеживать перемещение объекта в пространстве, постоянно вычисляя его местоположение и ориентацию относительно начальной точки.

Однако, у чисто инерциальных решений есть ряд недостатков~\cite{basebook}:

\begin{itemize}[label=---]
    \item накопление ошибок в процессе интегрирования ускорений и угловых скоростей, что приводит к постепенному дрейфу вычисляемых координат;
    \item невозможность определения абсолютного местоположения без привязки к известным опорным точкам;
    \item ограниченность времени работы из-за быстрого расходования энергии батарей.
\end{itemize}

Для преодоления данных проблем применяются гибридные подходы~\cite{hybridilf}, совмещающие инерциальную навигацию с другими технологиями позиционирования - RFID, WiFi, BLE, компьютерным зрением. Сочетание разнородной сенсорной информации и использование методов фильтрации, оценки состояния и машинного обучения позволяет обеспечить высокоточное и надежное геопозиционирование в помещениях~\cite{basebook}.

\subsection{Методы компьютерного зрения и SLAM}

Альтернативным направлением геопозиционирования в помещениях являются технологии, основанные на компьютерном зрении и одновременной локализации и картографировании (SLAM - Simultaneous Localization And Mapping)~\cite{slambased}.

В данном подходе используются камеры, установленные на мобильных устройствах (смартфоны, роботы), которые захватывают изображения окружающей обстановки. Специальные алгоритмы компьютерного зрения анализируют видеопоток, распознают визуальные ориентиры (текстуры, геометрические формы, QR-коды и т.д.), отслеживают их положение и движение. Совмещая эту информацию с данными инерциальных сенсоров, можно вычислять текущие координаты объекта в пространстве.

Технология SLAM не только определяет местоположение, но и создает трехмерную карту окружающей среды, используя данные камер и ИИУ. Таким образом достигается одновременная локализация объекта и построение пространственной модели помещения.

Основные преимущества решений на базе компьютерного зрения~\cite{compvision}:

\begin{itemize}[label=---]
    \item отсутствие необходимости в развертывании специальной инфраструктуры (маяков, точек доступа) --- достаточно камер мобильных устройств;
    \item возможность одновременного отслеживания нескольких объектов в поле зрения;
    \item высокая точность позиционирования (до 10 см) в определенных условиях;
    \item синергия с технологиями дополненной реальности.
\end{itemize}


Вместе с тем, технологии компьютерного зрения и SLAM имеют ряд ограничений~\cite{slambased}:

\begin{itemize}[label=---]
    \item высокие вычислительные и энергетические требования;
    \item чувствительность к освещению, видимости, загроможденности среды;
    \item необходимость предварительного картографирования помещений;
    \item сложность масштабирования на большие пространства.
\end{itemize}

\subsection{Интеграция различных сенсоров и данных}

Использование комбинации различных сенсоров, включая Wi-Fi, Bluetooth, RFID, ультразвук, видеокамеры и инерциальные измерительные устройства, позволяет получать более полную и разностороннюю информацию о местоположении объекта~\cite{multsensors}. Синтез данных от этих разнообразных источников с помощью сложных алгоритмов фильтрации и слияния повышает точность и устойчивость к помехам определения местоположения~\cite{trends}. Кроме того, совместный анализ контекстной информации, такой как планировка помещения, расположение объектов инфраструктуры, модели движения людей, помогает точнее локализовать объекты.

Основными компонентами интегрированной системы определения местоположения в помещениях могут быть:

\begin{itemize}[label=---]
    \item сенсоры Wi-Fi и Bluetooth~\cite{blwifi} --- определение местоположения на основе силы и направления сигналов беспроводных сетей и устройств;
    \item инерциальные измерительные блоки (IMU)~\cite{imu} --- акселерометры, гироскопы и магнитометры для отслеживания перемещений и ориентации объектов;
    \item сенсоры видеонаблюдения~\cite{compvision} --- камеры и алгоритмы компьютерного зрения для визуального определения местоположения;
    \item радиочастотная идентификация (RFID)~\cite{basebook} --- метки и считыватели для определения местоположения объектов с метками;
    \item ультразвуковые датчики~\cite{shielding} --- определение местоположения на основе времени распространения ультразвуковых сигналов.
\end{itemize}

Данные от этих и других сенсоров обрабатываются с помощью методов обработки сигналов, фильтрации, слияния данных и алгоритмов машинного обучения для повышения точности и надежности определения местоположения.

Основными преимуществами технологии интегрированной системы определения местоположения в помещениях являются~\cite{multsensors}:

\begin{itemize}[label=---]
    \item высокая точность --- комбинирование данных от различных сенсоров позволяет достичь точности определения местоположения в пределах нескольких метров, что значительно превосходит возможности GPS в помещениях;
    \item надежность --- избыточность сенсоров и данных повышает отказоустойчивость системы, снижая вероятность сбоев и потери сигнала;
    \item масштабируемость --- модульная архитектура таких систем позволяет легко наращивать количество сенсоров и расширять зону покрытия для обслуживания объектов любого размера;
    \item гибкость --- возможность адаптации к различным условиям и конфигурациям зданий, а также интеграция с другими системами делает технологию универсальной и легко настраиваемой.
\end{itemize}

Несмотря на множество преимуществ, интегрированные системы геопозиционирования в помещениях также имеют ряд недостатков~\cite{multsensors}:

\begin{itemize}[label=---]
    \item высокая стоимость --- развертывание и обслуживание таких систем требует значительных капитальных и эксплуатационных затрат, связанных с установкой и обслуживанием множества сенсоров, вычислительной инфраструктуры и программного обеспечения;
    \item сложность внедрения --- интеграция разнородных сенсоров и данных, настройка алгоритмов и калибровка системы представляют собой трудоемкий и сложный процесс, требующий высокой квалификации специалистов;
    \item ограниченность географического покрытия --- такие системы, как правило, ограничены конкретными зданиями или объектами и не обеспечивают непрерывное отслеживание перемещений за их пределами;
    \item чувствительность к окружающей среде --- работа системы может нарушаться из-за электромагнитных помех, изменений в инфраструктуре здания, присутствия людей и других факторов, влияющих на распространение сигналов сенсоров.
\end{itemize}

% Несмотря на эти недостатки, интегрированные системы геопозиционирования в помещениях продолжают развиваться и находить все более широкое применение благодаря своей высокой точности, надежности и универсальности. Дальнейшее совершенствование технологий, снижение стоимости и повышение безопасности этих систем будут способствовать их более широкому внедрению в различных сферах.

\subsection{Облачные вычисления и машинное обучение}

Применение облачных вычислений~\cite{cloudcomp} и технологий машинного обучения~\cite{mltech} открывает новые перспективы для систем геопозиционирования в помещениях. Облачные платформы обеспечивают вычислительные ресурсы, необходимые для обработки больших объемов сенсорных данных и реализации сложных алгоритмов локализации~\cite{cloudML}. Методы машинного обучения, такие как нейронные сети, позволяют автоматически извлекать скрытые закономерности в данных и повышать точность определения местоположения~\cite{mltech}. Кроме того, облачные решения упрощают интеграцию с другими системами и сервисами, расширяя возможности практического применения технологий геопозиционирования.

Основными преимуществами использования облачных вычислений и машинного обучения в системах геопозиционирования в помещениях являются~\cite{cloudML}:

\begin{itemize}[label=---]
    \item повышение точности и надежности --- облачные вычислительные мощности и алгоритмы машинного обучения позволяют обрабатывать большие объемы данных, выявлять сложные закономерности и улучшать точность определения местоположения;
    \item повышение эффективности --- автоматизация анализа данных, прогнозирование и поддержка принятия решений позволяют повысить эффективность использования ресурсов, оптимизировать процессы и снизить затраты;
    \item гибкость и масштабируемость --- облачная архитектура обеспечивает легкое масштабирование системы по мере роста количества сенсоров и пользователей, а также возможность быстрого развертывания и настройки;
    \item сокращение затрат --- отсутствие необходимости в локальной вычислительной инфраструктуре и передача вычислений в облако позволяют значительно снизить капитальные и эксплуатационные расходы;
    \item централизованное управление --- облачные технологии позволяют централизованно управлять системами геопозиционирования, удаленно настраивать алгоритмы и обновлять программное обеспечение;
    \item интеграция и взаимодействие --- облачные платформы упрощают интеграцию с другими корпоративными системами, обеспечивая единую и согласованную экосистему.
\end{itemize}

Несмотря на множество преимуществ, использование облачных вычислений и машинного обучения в системах геопозиционирования в помещениях также имеет ряд недостатков~\cite{cloudML}:

\begin{itemize}[label=---]
    \item зависимость от интернет-соединения --- стабильность и производительность системы напрямую зависит от качества интернет-соединения, что может быть проблематично в некоторых зданиях или удаленных объектах;
    \item сложность внедрения --- интеграция облачных технологий и настройка алгоритмов машинного обучения является более сложным и трудоемким процессом по сравнению с традиционными локальными системами;
    \item дополнительные расходы --- использование облачных вычислений и программного обеспечения может привести к дополнительным ежемесячным или ежегодным расходам, которые необходимо учитывать при бюджетировании;
    \item ограничения по обновлению --- обновление и доработка программного обеспечения, развернутого на облачной платформе, может быть ограничено возможностями поставщика облачных услуг;
    \item зависимость от поставщика облачных услуг --- использование облачных сервисов создает определенную зависимость от поставщика, что может усложнить переход на другие платформы в будущем.
\end{itemize}

\section{Анализ существующих методов}

Современные технологии дают возможность определять местоположение в открытой местности с помощью таких систем, как ГЛОНАСС и GPS. Представленные системы повсеместно используются, так как им необходим только один получатель (например, телефон) для определения местоположения~\cite{trends}. Однако сигналы от спутников GPS и ГЛОНАСС не могут проникать в помещения, чтобы точно определять местоположение объектов в закрытой местности, так как между спутником и объектом, местоположение которого необходимо определить, не должно быть препятствий~\cite{IGS}. 

В случае необходимости определения позиции объекта в помещении, применяют следующие технологии геопозиционирования: инерциальное~\cite{inertial}, Bluetooth~\cite{bluetooth}, WiFi~\cite{wifi}, ультразвуковое~\cite{ultrasound}, видимого освещения~\cite{light}. Наиболее популярными являются методы, использующие механизмы на основе WiFi~\cite{trends}.

Исторически выделяют три категории методов определения местоположения с применением устройств, генерирующих радиосигналы~\cite{wlan}:

\begin{itemize}[label=---]
    \item методы, применяющие AOA и связанный с ним DOA;
    \item методы, применяющие TOA и связанный с ним TDOA;
    \item методы, использующие опорные точки сигнала.
\end{itemize}

\subsection{Методы, основанные на AOA}

При рассмотрении методов, основным рабочим параметром которых является угол прибытия сигнала между принятой волной и некоторым направлением (ориентацией), необходимый угол измеряется как минимум от двух точек доступа~\cite{aoa}. 

\subsubsection{Алгоритм ангуляции}

На рисунке \ref{img:aoa} представлена простейшая LPS, состоящая из двух точек доступа и агента. Для определения местоположения источника сигнала (агента), необходимо задать координаты точек доступа --- $(x_1, y_1)$ и $(x_2, y_2)$ для первой и второй точки доступа соответственно. Искомые параметры --- координаты $(x_3, y_3)$ агента определяются по формулам (\ref{eq:aoa-x}) и (\ref{eq:aoa-y}).

\includeimage
    {aoa}
    {f}
    {h}
    {0.7\linewidth}
    {Принцип работы методов, основанных на AOA}

\begin{equation}
    x_3 = \frac{y_1 - y_2 + \frac{x_1}{tg\theta_1} + \frac{x_2}{tg\theta_2}}{\frac{1}{tg\theta_1} + \frac{1}{tg\theta_2}}
    \label{eq:aoa-x}
\end{equation}

\begin{equation}
    y_3 = y_1 - \frac{1}{tg\theta_1}\left(x_1 - \frac{y_1 - y_2 + \frac{x_1}{tg\theta_1} + \frac{x_2}{tg\theta_2}}{\frac{1}{tg\theta_1} + \frac{1}{tg\theta_2}}\right)
    \label{eq:aoa-y}
\end{equation}

Основной проблемой представленного метода является зависимость точности определения углов $\theta_1$ и $\theta_2$, необходимых для вычисления координат агента, от используемого оборудования, поэтому рассмотренный метод не является самым доступным~\cite{aoa-modern}. Также метод чувствителен к помехам и отражениям сигнала, что может привести к неточностям в определении местоположения, кроме того, точность этого метода снижается с увеличением дистанции между мобильным устройством и точками доступа. Это делает его менее надежным в больших помещениях или при наличии преград, таких как стены или перегородки~\cite{aoa}.

\clearpage

\subsection{Методы, основанные на TOA}

Методы, использующие для определения местоположения агента параметр TOA полагаются на время, за которое электромагнитная волна от агента достигает точки доступа~\cite{trends}. Метод требует строгой синхронизации часов, но отличается низкой стоимостью и низким потреблением энергии~\cite{toa}.

На рисунке \ref{img:toa} представлен пример LPS с использованием TOA.

\includeimage
    {toa}
    {f}
    {h}
    {0.8\linewidth}
    {Принцип работы методов, основанных на TOA}

\subsubsection{Алгоритм латерации}

Пусть $(x, y)$ --- неизвестные координаты агента, а $(x_i, y_i),~i \in [1, 3]$ --- координаты $i$-й точки доступа. Расстояние $R_i$ между точкой доступа и агентом определяется по формуле (\ref{eq:toa-r}):

\begin{equation}
    R_i = \sqrt{(x - x_i)^2 + (y - y_i)^2}.
    \label{eq:toa-r}
\end{equation}

Без ограничения общности, положим, что агент испускает сигнал во время $\tau_0 = 0$, а $i$-я точка доступа принимает сигнал во время $\tau_i$, где $\tau_i$ --- TOA. Тогда $R_i$ рассчитывается по формуле (\ref{eq:toa-t}):

\begin{equation}
    R_i = c \cdot \tau_i,
    \label{eq:toa-t}
\end{equation}
где $c$ --- скорость света. В таком случае позиция агента может быть определена как пересечение окружностей, с радиусами $R_1,~R_2,~R_3$, в условиях отсутствия помех~\cite{toa}.

Недостатком данного метода является ограниченная точность определения местоположения из-за влияния помех и отражений сигнала~\cite{toa}, когда сигнал от точки доступа распространяется через различные препятствия, могут возникать задержки и искажения, что усложняет точное определение времени прибытия сигнала и, следовательно, точности геопозиционирования.

Другим недостатком является ограничения аппаратного обеспечения, так как большинство коммерческих смартфонов не предназначены для точного измерения времени прибытия сигналов Wi-Fi --- у них отсутствует необходимое аппаратное обеспечение для выполнения таких измерений с высокой точностью~\cite{urban-info}.

\clearpage

\subsection{Методы, использующие опорные точки сигнала}

Методы, использующие опорные точки сигнала, также называемые методами сопоставления с образцом, представляют собой алгоритмы, построенные на анализе RSS. Сопоставление с образцом обычно происходит в два этапа: калибровка и геопозиционирование~\cite{intro}.

На рисунке \ref{img:falg} изображены две стадии работы метода опорных точек сигнала.

\includeimage
    {falg}
    {f}
    {h}
    {\linewidth}
    {Принцип работы методов, основанных на опорных точках сигнала}

В стадии калибровки (автономной фазы измерений) пространственно-временные RSS-данные от каждой точки доступа объединяются в общую базу данных и сохраняются как координаты опорных точек.

Местоположение агента может быть определено на стадии геопозиционирования с помощью измерения уровня сигналов от точек доступа и поиска наиболее точных совпадений в базе данных, с привязкой к точке на карте, где измерены такие же уровни сигналов.

Недостатками данного метода являются трудозатратный процесс конфигурации базы данных, необходимость переконфигурации при изменении ландшафта, а также высокая вычислительная сложность --- $O(N\cdot M)$, где $N$~--- количество записей в базе данных (количество опорных точек), а $M$~---~количество точек доступа $(M \geq 3)$~\cite{fingerprint}.

Методы геопозиционирования, основанные на опорных точках сигнала, используют один из двух подходов: детерминированный и стохастический~\cite{intro}.

\subsubsection{Детерминированный подход}

Детерминированный подход полагается на измерение уровня сигнала от каждой точки доступа и на основании этого определяет местоположение агента. Методы, использующие упомянутый подход, сравнивают уровни сигнала, полученные от агента с уровнями сигнала опорных точек, хранящихся в базе данных, оперируя Евклидовым расстоянием для определение ближайших соседей~\cite{fingerprint}.

\subsubsection{Алгоритм k-ближайших соседей}

Алгоритм k-ближайших соседей~\cite{knn} предполагает использование набора данных, полученного на стадии калибровки в методе опорных точек сигнала. Сам алгоритм работает следующим образом: для агента определяются k ближайших опорных точек из базы данных с помощью расстояния от $i$-й опорной точки до агента, которое рассчитывается по формуле (\ref{eq:fp:knn})

\begin{equation}
    D_i = \left(
        \frac{\sum\limits_{j=1}^{m} (|rss_j - rss_{ij}|)^t}{m}
    \right)^{\frac{1}{t}},
    \label{eq:fp:knn}
\end{equation}
где $i = \overline{1, n}$, $D_i$ --- манхэттенское расстояние от $i$-й опорной точки до агента (при $t = 1$) или евклидово расстояние (при $t = 2$), $m$ --- количество точек доступа, $rss_j$ --- уровень сигнала от агента до $j$-й точки доступа, $rss_{ij}$ --- уровень сигнала от $i$-й опорной точки до $j$-й точки доступа.

После выбора k ближайших к агенту опорных точек, местоположение агента может быть вычислено по формуле (\ref{eq:fp:location})

\begin{equation}
    (\hat{x}, \hat{y}) = \frac{\sum\limits_{i=1}^{k}(x_i, y_i)}{k},
    \label{eq:fp:location}
\end{equation}
где $(\hat{x}, \hat{y})$ --- координаты агента, $(x_i, y_i)$ --- координаты $i$-й опорной точки.

Ключевым преимуществом алгоритма k-ближайших соседей является эффективность при достаточном объеме данных, возможность использовать алгоритм в разнообразных сценариях, не имея предположений о распределении данных~\cite{trends}.

Недостатками алгоритма является высокая вычислительная сложность при большом объеме данных, а также требования к опорным точкам сигналов: на вход необходимо подать подготовленный набор данных, который минимизирует ошибки при аппроксимации местоположения агента в помещении~\cite{android-analysis}.

\subsubsection{Алгоритм взвешенных k-ближайших соседей}

Алгоритм взвешенных k-ближайших соседей~\cite{gansemer2010improved} заключается в присваивании весовых коэффициентов координатам различных опорных точек, которые обычно устанавливаются как обратное значение евклидова расстояния между опорной точкой и агентом~\cite{wknn}. Данный алгоритм поддается улучшениям, что показывает множество исследований, например, модификация данного алгоритма, которая заключается в высчитывания весовых коэффициентов на основе модели распространения сигнала, благодаря выявленной нелинейной связи между уровнем сигнала и физическим расстоянием~\cite{mwknn}.

\subsubsection{Алгоритмы на основе нейронных сетей}

Алгоритмы геопозиционирования на основе метода опорных точек, использующие нейронные сети, анализируют наборы векторов, описывающих распространение сигналов в опорных точках, используя эти данные для обучения~\cite{neural-networks}. 

Нейронная сеть может быть спроектирована как многослойный перцептрон, способный обрабатывать входные векторы отпечатков и выводить прогнозируемое местоположение. Обучение модели происходит путем подачи входных данных (пар местоположений опорных точек и векторов уровней сигналов в этих точках).

После завершения обучения модель можно использовать для геопозиционирования в реальном времени. При поступлении нового отпечатка сигнала WiFi нейронная сеть обрабатывает его и предсказывает местоположение, основываясь на заранее выученных закономерностях~\cite{trends}.

Преимущества данного подхода включают высокую точность определения местоположения в помещениях, а также возможность обучения модели на конкретных объектах, что позволяет улучшить качество геопозиционирования для конкретного помещения или даже отдельной зоны~\cite{neural-networks}.

Основные недостатки алгоритмов на основе нейронных сетей включают в себя следующие факторы: изменчивость среды может сильно влиять на точность геопозиционирования; для реализации геопозиционирования с помощью нейронных сетей необходимы дополнительные вычислительные ресурсы при большом количестве точек доступа и опорных точек.

\subsubsection{Стохастический подход}

Стохастический подход предполагает использование функции условного распределения для неизвестных параметров (координат агента)

Одной из ключевых особенностей стохастических алгоритмов является их способность учитывать случайные шумы и изменения в окружающей среде. Это означает, что данные, полученные с помощью метода опорных точек, могут быть подвержены различным искажениям, таким как влияние стен и преград, а также изменения внутренних условий помещения. Стохастические алгоритмы способны адаптироваться к таким условиям и проводить статистическую обработку данных для определения местоположения с учетом неопределенности~\cite{trends}.

Использование стохастических алгоритмов требует предварительной калибровки с помощью точных измерений сигналов WiFi в различных точках помещения~\cite{lin2021probabilistic}. Это может быть сложным и затратным процессом, требующим значительных ресурсов, особенно для больших помещений или для помещений с переменной конфигурацией.

\subsubsection{Скрытая Марковская модель}

% Скрытая модель Маркова состоит из двух стохастических процессов. Первый стохастический процесс представляет собой марковскую цепь, которая характеризуется состояниями и вероятностями перехода между ними. Состояния цепи не наблюдаются напрямую, поэтому они и называются "скрытыми". Второй стохастический процесс генерирует вероятность излучения, связанную с скрытыми состояниями в каждый момент времени, в зависимости от условного распределения состояний.

% Марковская цепь --- это стохастический процесс, включающий набор $N$ состояний с вероятностными переходами между состояниями. Вероятностное распределение переходов состояний обычно представляется как матрица переходов марковской цепи. Если цепь в настоящее время находится в состоянии $S_i$, то она переходит в состояние $S_j$ на следующем шаге с вероятностью, обозначаемой как $a_{ij}$. Матрица $A$ - это матрица вероятностей переходов размером $N \times N$, каждый элемент $a_{ij}$ известен как вероятность перехода и зависит только от текущего состояния $S_i$. Марковским называется процесс, обладающий следующим свойством: для каждого момента времени $t_0$ вероятность любого состояния системы в будущем зависит только от состояния системы в настоящем и не зависит от того, когда и каким образом система пришла в это состояние.

Скрытая Марковская модель --- это статистическая модель, в которой система моделируется как Марковский процесс с ненаблюдаемыми состояниями~\cite{mor2021systematic}. Её можно использовать для решения задачи геопозиционирования в помещении, так как она подходит для обработки временных рядов, которые представляют собой информацию о полученных агентом и опорными точками уровнями сигналов.

Рассмотрим помещение, разделённое на несколько областей (состояний модели), таких как комнаты или коридоры. Будем считать, что местоположение объекта в конкретный момент времени --- это состояние модели. Для примера, в случае, если у объекта только два возможных местоположения, мы получаем модель с двумя состояниями.

Вектор уровней сигналов, служит <<наблюдением>> в контексте скрытой Марковской модели. При использовании метода опорных точек на этапе обучения собираются данные о силе сигнала WiFi в каждом из возможных состояний, создавая так называемую <<опорную точку>>. Задача в этом контексте --- предсказать скрытое состояние модели (текущее местоположение объекта) на основе набора измерений векторов сигналов.

Формулы для Скрытой Марковской модели можно записать с помощью переходных (\ref{eq:mark:trans}) и эмиссионных (\ref{eq:mark:emission}) вероятностей.

\begin{eqnarray}
    P(i, j) &=& P(S_{t+1}=j|S_t=i), \label{eq:mark:trans} \\
    B_j(k) &=& P(O_t=k|S_t=j), \label{eq:mark:emission}
\end{eqnarray}
формула (\ref{eq:mark:trans}) представляет собой вероятность того, что система перейдёт из состояния $i$ в состояние $j$, а формула (\ref{eq:mark:emission}) располагает вероятностью того, что при данном сигнале $k$, система окажется в состоянии $j$.

Основная задача в этом случае --- на основе наблюдаемых данных (уровней сигналов WiFi) определить фактическое местоположение. Это можно сделать с помощью алгоритма Витерби~\cite{dong2020sequential}, который вычисляет наиболее вероятную последовательность скрытых состояний, давших наблюдаемые результаты.

Таким образом, построив Скрытую Марковскую модель и использовав уровни сигналов WiFi, можно определить местоположение объекта в помещении. Важным преимуществом данного подхода является его способность учитывать историю перемещения объекта, что делает его более точным при определении местоположения объекта в динамике, однако алгоритм неустойчив к изменениям в среде и интерференциям, а также требует предварительной калибровки~\cite{rudic2020geometry}.

\clearpage

\subsection*{Выводы из подраздела}

В результате рассмотрения методов геопозиционирования в помещениях на основе Wi-Fi, можно сделать следующие выводы:

\begin{itemize}[label=---]
    \item метод на основе анализа времени прибытия сигнала обеспечивает возможность точного позиционирования агента, при условии синхронизации часов на устройствах, участвующих в геопозиционировании, однако является неустойчивым к изменениям в среде и преградам между точкой доступа и агентом;
    \item метод на основе анализа угла прибытия сигнала обеспечивает простую аппроксимацию местоположения агента на коротких расстояниях, но требует дополнительного оборудования для работы, а также может выдавать неверные результаты на больших расстояниях и при наличии помех и преград;
    \item метод опорных точек сигнала поддается модификациям, что дает настроить геопозиционирование в конкретных помещениях, учитывая возможные помехи и преграды между точками доступа, однако неустойчив к изменениям в среде и требует предварительной калибровки перед использованием. 
\end{itemize}

\clearpage

\subsection{Методы геопозиционирования на основе Bluetooth}

Bluetooth с низким энергопотреблением (BLE) появился в стандарте Bluetooth 4.0 и рассчитан на беспроводную передачу данных на коротком расстоянии~\cite{bluetooth}. Исходя из этих данных, ожидаемые ошибки при использовании методов геопозиционирования, основанных на Bluetooth гораздо меньше, в сравнении с методами геопозиционирования на основе WiFi~\cite{blwifi}.

% В то же время, по сравнению с методами определения местоположения агента внутри помещений, основанных на использовании точек доступа WiFi, системы геопозиционирования, основанные на BLE всегда требуют дополнительного оборудования, благодаря чему могут достигнуть более высокой точности~\cite{android-analysis}.

Методы геопозиционирования с помощью WiFi и Bluetooth включают в себя измерение сигналов от ближайших точек доступа (для Wi-Fi) или маяков (для BLE), а затем использование этой информации для вычисления координат устройства. Это предоставляет возможность использовать все вышеописанные методы геопозиционирования в помещениях и для BLE. Однако есть несколько ключевых различий между этими двумя технологиями.

Главным различием служит сама технология передачи данных. Wi-Fi использует стандарт IEEE 802.11~\cite{ieee802} для передачи данных, в то время как BLE использует более энергоэффективный протокол передачи данных. Это позволяет BLE использовать меньше энергии и обеспечивает длительное время работы устройства без подзарядки~\cite{bluetooth}.

Еще одним различием является диапазон работы. Wi-Fi обычно имеет больший диапазон работы, чем BLE, что делает его более подходящим для позиционирования на больших расстояниях~\cite{wlan}. Однако BLE обычно обеспечивает более точное позиционирование на небольших расстояниях благодаря использованию маяков и возможности определения расстояния до устройства с точностью до нескольких сантиметров~\cite{android-analysis}.

Кроме того, BLE обычно имеет более низкую задержку передачи данных по сравнению с Wi-Fi \cite{android-analysis}, что делает его более подходящим для реального времени позиционирования, однако для геопозиционирования в больших зданиях необходимо приобрести множество маяков, в связи с небольшим диапазоном работы BLE.

Таким образом, обе технологии имеют свои преимущества и недостатки, и выбор между ними зависит от конкретных требований проекта, использующего геопозиционирование.

\clearpage

\subsection*{Выводы из подраздела}

Методы геопозиционирования в помещениях с использованием Bluetooth являются одними из наиболее эффективных средств определения местоположения агента внутри здания, однако не лишены недостатков.

Для работы методов геопозиционирования на основе BLE используются те же методы, что и для Wi-Fi, в результате чего сохраняются их преимущества и недостатки. Однако BLE является более энергоэффективной технологией, а также позволяет определить расстояние до устройства с точностью до нескольких сантиметров~\cite{bluetooth}. 

Основными недостатками методов, использующих BLE является низкий диапазон работы, что делает их более дорогим решением, в сравнении с использованием методов на основе Wi-Fi, в связи с тем, что необходимо приобретение множества маяков.

\clearpage

\subsection{Классификация методов геопозиционирования на основе WiFi и Bluetooth}

На рисунке \ref{img:classification} приведена классификация рассмотренных методов геопозиционирования в помещениях на основе Wi-Fi и Bluetooth.

\includeimage
    {classification}
    {f}
    {h}
    {\linewidth}
    {Классификация методов геопозиционирования в помещении}

\clearpage

В таблице \ref{table:classification} приведено сравнение методов геопозиционирования в помещении.

\begin{table}[ht]
    \caption{Классификация алгоритмов геопозиционирования в помещении}
    \begin{tabular}{|m{3cm}|m{3.5cm}|m{3cm}|m{5.5cm}|}
        \hline
        Метод & Используемая информация & Измерения & Недостатки и преимущества \\
        \hline
        \hline
        Анализа времени прибытия сигналов & геометрические параметры & время прибытия сигнала & ограничения аппаратного обеспечения; сильное влияние помех и отражений сигнала на результат \\
        \hline
        Анализа угла прибытия сигналов & геометрические параметры & углы прибытия сигнала & необходимо дополнительное оборудование; чувствителен к помехам и отражениям сигнала; ненадежен на больших расстояниях \\
        \hline
        Опорных точек сигнала & статистические и эмпирические результаты & уровень сигнала & отсутствие необходимости в дополнительном оборудовании для помещений, в которых настроена сеть Wi-Fi; затруднительны для использования в часто изменяющихся пространствах; требуют предварительной калибровки \\
        \hline
    \end{tabular}
    \label{table:classification}
\end{table}

\subsection*{Выводы из подраздела}

Исходя из классификации видно, что наиболее гибким и эффективным методом определения местоположения является использование метода, основанного на опорных точках сигнала. Это связано с тем, что для конкретного помещения можно занести в базу данных, необходимую для работы алгоритма, специально расположенные опорные точки, которые будут учитывать помехи и отражения сигнала, давая более точные данные для определенного набора помещений~\cite{bag}. Также следует отметить, что алгоритмы, работающие на основе метода опорных точек, не требуют дополнительных закупок со стороны организации, планирующей использовать его в своих помещениях, если в них настроена сеть Wi-Fi с более, чем тремя точками доступа.

\section{Формализация постановки задачи}

Метод опорных точек сигнала для геопозиционирования в помещениях с использованием сигналов Wi-Fi основывается на сравнении измеренных характеристик сигнала Wi-Fi в произвольной точке помещения с заранее собранной базой данных опорных точек.

\subsection*{Входные данные}

\begin{enumerate}
    \item Карта помещения с отмеченными координатами опорных точек.
    \item База данных опорных точек, содержащая информацию о характеристиках сигналов Wi-Fi в каждой из опорных точек. Типичными характеристиками являются уровень принимаемого сигнала (RSSI) от различных точек доступа Wi-Fi, а также информация о самих точках доступа (MAC-адреса, SSID).
    \item Текущие измерения характеристик сигналов Wi-Fi в произвольной точке помещения, для которой необходимо определить местоположение (в точке нахождения агента).
\end{enumerate}

\subsection*{Выходные данные}

\begin{enumerate}
    \item Оценка местоположения объекта в помещении, выраженная в координатах на карте.
    \item Мера уверенности в полученной оценке местоположения в виде расстояния до ближайшей опорной точки.
\end{enumerate}

Применение данного метода позволяет достичь точности геопозиционирования в помещениях на уровне нескольких метров при относительно невысокой стоимости развёртывания системы, поскольку он использует существующую инфраструктуру Wi-Fi.

\clearpage

На рисунке \ref{img:idef0} представлена формализация постановки задачи в виде IDEF0-диаграммы.

\includeimage
    {idef0}
    {f}
    {H}
    {\linewidth}
    {Формализация постановки задачи в виде IDEF0}
